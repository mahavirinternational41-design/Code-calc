import streamlit as st
import math

# Configuration
SECRET_KEY = "MONEYTRACK"
# Mapping: M=1, O=2, N=3, E=4, Y=5, T=6, R=7, A=8, C=9, K=0
KEY_MAP = {str((i + 1) % 10): char for i, char in enumerate(SECRET_KEY)}

def encode_price(price):
    """Converts a numerical price into the secret MONEYTRACK code."""
    price_str = str(math.ceil(price))
    encoded = "".join(KEY_MAP.get(digit, digit) for digit in price_str)
    return encoded

# UI Layout
st.set_page_config(page_title="Secret Price Calc", layout="centered")
st.title("üè∑Ô∏è Secret Price Calculator")
st.subheader(f"Key: {SECRET_KEY}")

with st.form("calc_form"):
    col1, col2 = st.columns(2)
    
    with col1:
        product_name = st.text_input("Product Name", placeholder="e.g., Leather Bag")
        cost_price = st.number_input("Cost Price (‚Çπ)", min_value=0.0, step=1.0)
        overhead = st.number_input("Overhead/Shipping (‚Çπ)", min_value=0.0, step=1.0)

    with col2:
        margin_pct = st.number_input("Profit Margin (%)", min_value=0.0, value=20.0, step=1.0)
        gst_pct = st.number_input("GST Rate (%)", min_value=0.0, value=18.0, step=1.0)

    submitted = st.form_submit_button("Calculate & Encode")

if submitted:
    # 1. Calculate Total Cost
    total_cost = cost_price + overhead
    
    # 2. Add Profit Margin
    price_with_margin = total_cost * (1 + margin_pct / 100)
    
    # 3. Final Selling Price (including GST)
    final_selling_price = price_with_margin * (1 + gst_pct / 100)
    
    # 4. Generate Secret Code
    secret_code = encode_price(final_selling_price)
    
    # Results Display
    st.divider()
    st.success(f"### Secret Code: **{secret_code}**")
